
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../practica13_4/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.13">
    
    
      
        <title>Práctica 14_1 - IAW Daniel Magaña</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.ffa9267a.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#practica-141-instalacion-de-wordpress-usando-contenedores-docker-y-docker-compose" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="IAW Daniel Magaña" class="md-header__button md-logo" aria-label="IAW Daniel Magaña" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            IAW Daniel Magaña
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Práctica 14_1
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="IAW Daniel Magaña" class="md-nav__button md-logo" aria-label="IAW Daniel Magaña" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    IAW Daniel Magaña
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Principal
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../about/" class="md-nav__link">
        Acerca de
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Primer Trimestre
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Primer Trimestre
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../6-prestasho-ansible/" class="md-nav__link">
        Práctica 6
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../9-practica/" class="md-nav__link">
        Práctica 9
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Segundo Trimestre
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Segundo Trimestre
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../practica13_4/" class="md-nav__link">
        Práctica 13_4
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Práctica 14_1
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Práctica 14_1
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#para-la-creacion-de-la-instancia" class="md-nav__link">
    Para la creación de la Instancia
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#apartado-de-las-imagenes-docker" class="md-nav__link">
    Apartado de las imágenes Docker
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ejecutar-los-servicios-e-instalar-las-herramientas-necesarias-para-el-proceso" class="md-nav__link">
    Ejecutar los servicios e instalar las herramientas necesarias para el proceso
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comprobacion" class="md-nav__link">
    Comprobación
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#para-la-creacion-de-la-instancia" class="md-nav__link">
    Para la creación de la Instancia
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#apartado-de-las-imagenes-docker" class="md-nav__link">
    Apartado de las imágenes Docker
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ejecutar-los-servicios-e-instalar-las-herramientas-necesarias-para-el-proceso" class="md-nav__link">
    Ejecutar los servicios e instalar las herramientas necesarias para el proceso
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comprobacion" class="md-nav__link">
    Comprobación
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="practica-141-instalacion-de-wordpress-usando-contenedores-docker-y-docker-compose">Practica 14.1 Instalación de WordPress usando contenedores Docker y Docker Compose</h1>
<h2 id="para-la-creacion-de-la-instancia"><strong>Para la creación de la Instancia</strong></h2>
<p>Voy a usar terraform debido a su sencillez y que requiere de menor tiempo a la hora de generar grupos de seguridad , instancia y demás.</p>
<p><strong>Importante</strong> voy a tener los puertos :</p>
<ul>
<li><strong>80</strong> y el <strong>443</strong> lo utilizará la imagen de https-portal.</li>
<li><strong>8080</strong> Es el puerto que utilizaremos para el phpmyadmin y así conectarnos.</li>
<li><strong>22</strong> Nos conectaremos por ssh.</li>
</ul>
<p>Para ejecutar el archivo tendremos que escribir:</p>
<pre><code class="language-command">terraform init
</code></pre>
<p>EL comando mencionado nos instalará los módulos necesarios para ejecutar el archivo.</p>
<p>EL siguiente comandonos permitirá lo que es el archivo (recordar, que para ejecutar este comando como el anterior hay que estar dentro del directorio):</p>
<pre><code class="language-command">terraform apply
</code></pre>
<p>Contenido del archivo es el siguiente:</p>
<pre><code class="language-terraform">#Configuramos el proveedor de AWS y le ponemos la región.

provider &quot;aws&quot; {
  region = &quot;us-east-1&quot;
}

#---------------------------------------------------------------------------------------------------------------------------------
#Creamos la maquina junto con sus recursos
#-------------------------------------------------------------------------------------------------------------------------------------------

# Creamos un grupo de seguridad, especificando las condiciones que tendrá.
#No hay que preocuparse por nivelarlas la información por el comando terraform fmt.
#En aws_security_group (este parametro es un recurso, por lo tanto debe de ser la misma) le decimos que va a ser un grupo de seguridad.

resource &quot;aws_security_group&quot; &quot;sg_practica14_1&quot; {
  name        = &quot;sg_practica14_1&quot;
  description = &quot;Grupo de seguridad para la instancia de sg_practica14_1&quot;

  #Especificamos los puertos y su condiciones

  ingress {
    from_port   = 22
    to_port     = 22
    protocol    = &quot;tcp&quot;
    cidr_blocks = [&quot;0.0.0.0/0&quot;]
  }

  ingress {
    from_port   = 80
    to_port     = 80
    protocol    = &quot;tcp&quot;
    cidr_blocks = [&quot;0.0.0.0/0&quot;]
  }

  ingress {
    from_port   = 443
    to_port     = 443
    protocol    = &quot;tcp&quot;
    cidr_blocks = [&quot;0.0.0.0/0&quot;]
  }
  ingress {
    from_port   = 8080
    to_port     = 8080
    protocol    = &quot;tcp&quot;
    cidr_blocks = [&quot;0.0.0.0/0&quot;]
  }
#Las siguientes lineas son para las reglas de salida (son importante ya que de lo contrario no podría por ejemplo actualizar repositorios)
  egress {
    from_port = 0
    to_port = 0
    protocol = &quot;-1&quot;
    cidr_blocks = [&quot;0.0.0.0/0&quot;]
  }
}

# Creamos la instancia
#La primera línea es para declarar lo que vamos a hacer.
#Después le pasamos los elementos ensenciales como la ami, 
#su capacidad, la clave shh y asíganamos la instancia al grupo.


resource &quot;aws_instance&quot; &quot;practica14_1&quot; {
  ami             = &quot;ami-00874d747dde814fa&quot;
  instance_type   = &quot;t2.large&quot;
  key_name        = &quot;vockey&quot;

#En security_groups especificamos el grupo de seguridad.

  security_groups = [aws_security_group.sg_practica14_1.name]

  #En la siguiente línea ponemos el nombre a la instancia.
  tags = {
    Name = &quot;practica14_1&quot;
  }
}

# Creamos una IP elástica. En este apartado hago referencia 
#al nombre de la instancia. 

resource &quot;aws_eip&quot; &quot;ip_elastica&quot; {
  instance = aws_instance.practica14_1.id
}

# Mostramos la IP pública de la instancia
output &quot;elastic_ip&quot; {
  value = aws_eip.ip_elastica.public_ip
}
</code></pre>
<h2 id="apartado-de-las-imagenes-docker"><strong>Apartado de las imágenes Docker</strong></h2>
<p>Para ello voy a utilizar un archivo llamado docker-compose.yml y tendrá un archivo .env (que tendrá el contenido de las variables).</p>
<pre><code class="language-env"># WordPress variables

#Nombre de la base de datos.
WORDPRESS_DB_NAME=wp_database

#Nombre del usuario
WORDPRESS_DB_USER=wp_user

#NOmbre de la contraseña
WORDPRESS_DB_PASSWORD=wp_password

# MySQL Server environment variables
MYSQL_ROOT_PASSWORD=root
</code></pre>
<p>El contenido del archivo docker-compose.yml:</p>
<pre><code class="language-yml">
version: '3'

#En services declaramos las imágenes y demás.

services:

#Instalación de la imágen de wordpress esta imágen está sacada de docker hub, si yo en image pongo wordpress por defecto me cogerá la version latest. (Me cogerá siempre la última el problema de esto que puede salir una versión que no sea compatible, por eso pongo una versión concreta)

  wordpress:
    image: wordpress:6.1
    #En ports pongo los puertos , en esta imagen como más adelante voy a usar https por eso no asignaré los puerto a wordpress ya que podría dar problemas.
#    ports:
#      - 80:80
    environment:
    #En las siguientes lineas usaremos las variables : (importante, para declarar las variables hay que leer las instrucciones de como funcionan dichas variables.)

    #Ponemos el nombre del servicio de mysql.
    #Asignamos el nombre a la base de datos
    #Asignamos el nombre del usuario para la base de datos.
    #Asignamos contraseña a dicho usuario
      - WORDPRESS_DB_HOST=mysql
      - WORDPRESS_DB_NAME=${WORDPRESS_DB_NAME}
      - WORDPRESS_DB_USER=${WORDPRESS_DB_USER}
      - WORDPRESS_DB_PASSWORD=${WORDPRESS_DB_PASSWORD}
    volumes: 
    #Montamos el volumen, esta dirección hay que consultarlo en docker hub (wordpress), debido a que no puedo poner la ruta que yo quiera sino la que me diga en las instrucciones, de lo contrario no funcionará.
    #Si pongo wordpress_data no compartirá nada de mi ordenador a la imagen, si yo quisiera que usará archivos locales pondría ./ruta_del_archivo.
      - wordpress_data:/var/www/html
    depends_on:
    #Para indicarle que se inicie cuando la imagen de mysql, se inicie y además cuando mysql funcione bien
      mysql:
        condition: service_healthy
    #En caso de error que reinicie siempre.
    restart: always
    #Declaramos las redes a las que pertenece (wordpress necesita estar en las dos debido a que necesitará tener acceso a mysql (backend-network) y al exterior para ofrecer contenido al exterior(frontend-network))
    networks: 
      - frontend-network
      - backend-network

#Para la imagen de mysql.

#En imagen ponemos la versión que queremos descargar en mi caso es mysql:8.0

  mysql:
    image: mysql:8.0
    ports:
    #Ponemos el puerto que usará, el puerto 3306 lo voy a comentar por seguridad, ya que no quiero que cualquiera pueda acceder.
#      - 3306:3306
    environment:

    #Usamos las variables para:

    #Usar contraseña de root.
    #Asignamos el nombre a la base de datos
    #Asignamos el nombre del usuario para la base de datos.
    #Asignamos contraseña a dicho usuario

      - MYSQL_ROOT_PASSWORD=${MYSQL_ROOT_PASSWORD}
      - MYSQL_DATABASE=${WORDPRESS_DB_NAME}
      - MYSQL_USER=${WORDPRESS_DB_USER}
      - MYSQL_PASSWORD=${WORDPRESS_DB_PASSWORD}
    volumes:
    #Generamos el volumen, y nos fijamos que la ruta que hemos puesto es la que viene en las instrucciones.
      - mysql_data:/var/lib/mysql
    #En caso de que haya algún error se reiniciará siempre.  
    restart: always
    #Importante:
    # El healthcheck, sirve para garantizar que el servicio de MySQL está listo para aceptar conexiones, si yo pusiera depends (y el servicio) significaría como ese este iniciado, healthcheck no es cuando se haya iniciado sino que se produce hasta que al fin se haya comprobado que los parametros hayan transcurrido con exito.

    #En este caso me comrpueba el usuario y la contraseña
    healthcheck:
      test: mysql --user=${WORDPRESS_DB_USER} --password=${WORDPRESS_DB_PASSWORD} -e &quot;SHOW DATABASES;&quot;
    #interval: Especifica la frecuencia con la que se ejecutará el healthcheck. En este caso, se está especificando un intervalo de 6 segundos.

    #timeout: Especifica el tiempo máximo que se permitirá para que el healthcheck complete. En este caso, se está especificando un timeout de 3 segundos.

    #retries: Especifica el número de intentos que se realizarán si el healthcheck falla. En este caso, se está especificando 5 intentos.
      interval: 6s
      timeout: 3s
      retries: 5
    networks: 
    #Añadimos la red
      - backend-network

#Ahora usaremos la imagen phpmyadmin la version 5.2
  phpmyadmin:
    image: phpmyadmin:5.2
    ports:
    #NOs conectaremos por el puerto 8080
      - 8080:80
    environment: 
      - PMA_HOST=mysql
      #Ponemos que se inicie cuando funcione perfectamente mysql
    depends_on:
      mysql:
        condition: service_healthy
    #Reiniciamos siempre
    restart: always
    #Phpmyadmin debe de estar en las dos redes.
    networks: 
      - frontend-network
      - backend-network

#Usaremos la imagen https-portal version 1, importante aclarar que no es oficial, esta imagen está desarrollada por steveltn

  https-portal:
    image: steveltn/https-portal:1
    ports:
    #Los puertos que trabajará son los siguientes:
      - 80:80
      - 443:443

    #Montamos el volume en /var/lib/https-portal
    volumes:
      - ssl_certs_data:/var/lib/https-portal
    environment:
    #He puesto dos tipos de dominios, no pueden ser dos a la vez, la primera se usará de forma local y la otra es para acceder a internet, el dominio que pongo tiene que estar registrado en no-ip.
    # http://wordpress:80 es wordpress debido al nombre del servicio, si tuviese otro nombre cambiariamos wordpress por el nombre del servicio que actue por wordpress

#      DOMAINS: 'localhost -&gt; http://wordpress:80 #local'
      DOMAINS: 'dmp-test.ddns.net -&gt; http://wordpress:80 #production'
    depends_on:
    #Ponemos que este servicio se monte cuando wordpress haya iniciado
      - wordpress
    #Reiniciamos siempre
    restart: always
    #Estará en la red frontend-network , no necesita estar en backend-network, ya que esta wordpress.
    networks:
      - frontend-network

#Tenemos que volver a declarar la ruta de los volumenes.

volumes:
  mysql_data:
  wordpress_data:
  ssl_certs_data:

#Tenemos que volver a declarar el nombre de las redes.

networks:
  frontend-network:
  backend-network:
</code></pre>
<p>Ya tendremos creada la instancia y el archivo docker-compose.yml con las imagenes.</p>
<p>Faltaría ejecutar el archivo docker-compose.yml y sus herramintas:</p>
<h2 id="ejecutar-los-servicios-e-instalar-las-herramientas-necesarias-para-el-proceso"><strong>Ejecutar los servicios e instalar las herramientas necesarias para el proceso</strong></h2>
<pre><code class="language-yml">---
- name: Playbook para instalar preparar los servicios de la maquina docker
  hosts: maquina
  become: yes

  tasks:

    - name: Actualizar los repositorios
      apt:
        update_cache: yes

    - name: Instalar el docker.io
      apt:
        name: docker.io
        state: present

    - name: Instalamos pip
      apt:
        name: python3-pip
        state: present

    - name: Instalar el docker
      pip:
        name: docker
        state: present

    - name: Instalar el docker-compose
      pip:
        name: docker-compose
        state: present


    - name: Creamos el directorio
      file:
        path: /home/ubuntu/.docker/cli-plugins
        state: directory
        mode: 0775
        owner: ubuntu
        group: ubuntu

    - name: Descargar docker compose
      get_url:
        url: https://github.com/docker/compose/releases/download/v2.15.1/docker-compose-linux-x86_64
        dest: /home/ubuntu/.docker/cli-plugins/docker-compose
        mode: 0775
        owner: ubuntu
        group: ubuntu

    - name: Añadimos el usuario al grupo docker
      user:
        name: ubuntu
        groups: docker
        append: yes

    - name: Permisos de socket docker
      file:
        path: /var/run/docker.sock
        mode: 0777

    - name: Reiniciamos docker
      service:
        name: docker
        state: restarted

    - name: Copiamos el archivo
      copy:
        src: ../../docker/
        dest: /home/ubuntu/docker

    - name: Ejecutar docker-compose
      docker_compose:
        project_src: /home/ubuntu/docker
        files:
          - docker-compose.yml
        state: present
        docker_host: unix://var/run/docker.sock
</code></pre>
<h2 id="comprobacion"><strong>Comprobación</strong></h2>
<p>Si pongo el dominio en el navegador, aparecerá wordpress (ya lo habia instalado):</p>
<p><img alt="" src="https://github.com/Daniel-Magana512/mkdocks/blob/main/fotos_practicas/foto_practica_14_1/foto1.png?raw=true" /></p>
<p>Si pongo el dominio (poniendo http) y el puerto:8080 me llevará a phpmyadmin:
<img alt="" src="https://github.com/Daniel-Magana512/mkdocks/blob/main/fotos_practicas/foto_practica_14_1/foto2.png?raw=true" /></p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.2a6f1dda.min.js"></script>
      
    
  </body>
</html>